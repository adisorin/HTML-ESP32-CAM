<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>ESP32-CAM Viewer cu IP-uri Locale</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      height: 100vh;
      margin: 0;
      padding-top: 20px;
    }

    h1 {
      color: #333;
      margin-bottom: 15px;
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    button {
      padding: 14px 28px;              /* Butoane mai mari */
      border: none;
      font-size: 18px;                 /* Text mai mare */
      font-weight: 600;                /* Text mai vizibil */
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    button:hover {
      transform: scale(1.05);          /* Mic efect la hover */
    }

    .local { background-color: #007bff; color: white; }
    .local:hover { background-color: #0056b3; }
    .remote { background-color: #28a745; color: white; }
    .remote:hover { background-color: #1c7a2d; }
    .disconnect { background-color: #dc3545; color: white; }
    .disconnect:hover { background-color: #a71d2a; }

    .video-frame {
      width: 700px;
      height: 520px;
      border: 3px solid #333;
      border-radius: 12px;
      background-color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 15px;
      position: relative;
    }

    .video-frame img { width: 100%; height: 100%; object-fit: cover; }

    .spinner {
      border: 6px solid #ccc;
      border-top: 6px solid #007bff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status { 
      margin-bottom: 15px; 
      font-size: 16px; 
      color: #555; 
    }
	.error-message {
      color: red;
      font-weight: 600;
      animation: shake 0.3s ease-in-out;
    }
	
	@keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    h3 {
      margin-bottom: 10px;
      font-size: 20px;
    }

    .ip-list {
      width: 700px;
      background: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      max-height: 180px;
      overflow-y: auto;
    }

    .ip-list button {
      display: block;
      width: 100%;
      margin: 6px 0;
      text-align: left;
      background-color: #eee;
      color: #333;
      font-size: 16px;              /* Text mai mare √Æn lista IP */
      padding: 12px 18px;           /* Butoane IP mai mari */
      border-radius: 8px;
    }
	
	.status-wait {
	  color: #007bff;   /* Albastru */
      font-weight: 600;
	}

	.status-disconnected {
      color: #dc3545;   /* Ro»ôu */
      font-weight: 600;
	}

    .ip-list button:hover { background-color: #ccc; }

  </style>
</head>
<body>

  <h1>ESP32-CAM Viewer</h1>

  <div class="controls">
    <button class="local" onclick="connectLocal()">Conectare LocalƒÉ</button>
    <button class="remote" onclick="connectRemote()">Conectare ExternƒÉ (GO.RO)</button>
    <button class="disconnect" onclick="disconnect()">Deconectare</button>
  </div>

  <div class="video-frame" id="videoFrame">
    <span style="color: #888;">Niciun stream activ...</span>
  </div>

  <div class="status status-wait" id="status">A»ôtept conexiune...</div>


  <h3>IP-uri locale disponibile</h3>
  <div class="ip-list" id="ipList"></div>

  <script>
  const localIP = "192.168.0.244:81";
  const remoteIP = "xxxxxxxsecret.go.ro:81"; //rds

  const videoFrame = document.getElementById('videoFrame');
  const status = document.getElementById('status');
  const ipListDiv = document.getElementById('ipList');

  let currentStream = null;
  let connectionId = 0;  // üî• ID unic pentru fiecare conectare

  const localIPs = [
    "192.168.0.245:81",
    "192.168.0.246:81",
    "192.168.0.247:81"
  ];

  localIPs.forEach(ip => {
    const btn = document.createElement('button');
    btn.textContent = ip;
    btn.onclick = () => connectTo(ip, `Conectat la ${ip}`);
    ipListDiv.appendChild(btn);
  });

  function connectLocal() { connectTo(localIP, "Conectat Local"); }
  function connectRemote() { connectTo(remoteIP, "Conectat Extern (GO.RO)"); }

  function connectTo(ip, label) {
    disconnect();

    connectionId++;              // üî• creƒÉm un ID pentru aceastƒÉ conexiune
    const thisId = connectionId; // √Æl capturƒÉm √Æn variabilƒÉ localƒÉ

    videoFrame.innerHTML = `<div class="spinner"></div>`;
    status.textContent = "Se conecteazƒÉ la " + ip + "...";
	status.className = "status status-wait";


    const img = new Image();
    img.src = `http://${ip}/stream`;
    img.alt = "ESP32-CAM Stream";

    img.onload = () => {
      if (thisId !== connectionId) return;  // ‚ùå ignore load de la conexiuni vechi
      videoFrame.innerHTML = "";
      videoFrame.appendChild(img);
      currentStream = img;
      status.textContent = `${label}: http://${ip}/stream`;
    };

    img.onerror = () => {
      if (thisId !== connectionId) return; // ‚ùå ignorƒÉm erorile vechi
      handleError();
    };
  }

  function disconnect() {
    connectionId++; // üî• InvalideazƒÉ orice onload/onerror vechi
    if (currentStream) {
      currentStream.src = "";
      currentStream.removeAttribute('src');
      currentStream = null;
    }
    videoFrame.innerHTML = `<span style='color:red;'>Niciun stream activ...</span>`;
    status.textContent = "Deconectat de la ESP32-CAM.";
	status.className = "status status-disconnected";

  }

  function handleError() {
    disconnect();
    videoFrame.innerHTML = `<span class='error-message'>‚ùå Eroare la conectare! VerificƒÉ IP-ul sau portul.</span>`;
    status.textContent = "Conexiune e»ôuatƒÉ.";
	status.className = "status status-disconnected";

  }
</script>



</body>
</html>
